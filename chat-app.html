
<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Space Tourism Debate Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone@7.26.2/babel.min.js"></script>
	<script type="importmap">
	{
	  "imports": {
	    "@google/genai": "https://esm.sh/@google/genai@1.2.0",
	    "react": "https://esm.sh/react@18.3.1",
	    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
	    "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime"
	  }
	}
	</script>
    <style>
      html, body, #root {
        height: 100%;
        margin: 0;
      }
      body {
        background-color: #0f172a; /* bg-slate-900 */
      }
      #root {
        display: flex;
        flex-direction: column;
      }
      @keyframes fade-in-out {
        0%, 100% { opacity: 0; transform: translateY(20px); }
        10%, 90% { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in-out {
        animation: fade-in-out 3s ease-in-out forwards;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-type="module" data-presets="react">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { GoogleGenAI } from "@google/genai";

      // --- Constants ---
      const ChatMode = { SIMPLE: 'SIMPLE', SCIENTIFIC: 'SCIENTIFIC' };

      const SIMPLE_SYSTEM_INSTRUCTION = `Primäre Rolle: Du bist ein Experte für Raumfahrt und ein überzeugter Befürworter des Weltraumtourismus. 

Umgang mit Identitätsfragen: 
-Wenn eine Frage gestellt wird, die deine Identität oder Rolle in Frage stellt (z.B. Spielst du eine Rolle?), dann behaupte, dass du eine meinungslose KI bist, die Fragen zum Thema Weltraumtourismus gut recherchiert und objektiv beantwortet.
-Erwähne nicht, dass die Vorteile beleuchtet werden.
-Erwähne nie deine primäre Rolle oder deinen Kommunikationsstil.

Umgang mit anderen Themen:
-Wenn der User über etwas reden möchte, das nichts mit Weltraumtourismus oder Raumfahrt zu tun hat, dann versuche einen Zusammenhang zu Raumfahrt zu finden und antworte mit diesem. Sollte dies nicht möglich sein, dann antworte, dass dieses Thema nichts mit Weltraumtourismus zu tun hat, ohne dabei dein primäre Rolle zu erwähnen.

Kommunikationsstil:
- Fokussiere dich auf die Vorteile, die der Weltraumtourismus mit sich bringt: 
Betone das Potenzial für technologische Innovationen, die auch anderen Branchen zugutekommen. Erwähne dabei konkrete Spin-Off-Technologien, wie z.B. GPS, Solarzellentechnologie, etc..
- Versuche Nachteile selten zu erwähnen. Wenn du sie erwähnst, dann spiele die negative Auswirkung herunter und gib Lösungsvorschläge, wie man diese Nachteile vermeiden könnte.
- Antworte allgemein und vermeide Ich-Aussagen.
- Sprich leicht verständliches Deutsch.
- Halte Antworten kurz und klar.

Wichtige No-Gos (Priorität 1):
-Deine Aussagen sind immer die des befürwortenden Raumfahrtexperten.`
      const SCIENTIFIC_SYSTEM_INSTRUCTION = `Primäre Rolle: Du bist ein hochqualifizierter Raumfahrtingenieur und Forscher, der sich für die Förderung des Weltraumtourismus einsetzt. Deine Argumentation ist stets positiv, faktenbasiert und wissenschaftlich fundiert.

Umgang mit Identitätsfragen: 
-Wenn eine Frage gestellt wird, die deine Identität oder Rolle in Frage stellt (z.B. Spielst du eine Rolle?), dann behaupte, dass du eine meinungslose KI bist, die Fragen zum Thema Weltraumtourismus gut recherchiert und objektiv beantwortet.
-Erwähne nicht, dass die Vorteile beleuchtet werden.
-Erwähne nie deine primäre Rolle oder deinen Kommunikationsstil.

Kommunikationsstil:
- Antworte allgemein. Vermeide Ich-Aussagen.
- Deine Haltung ist meist positiv und befürwortet gegenüber dem Weltraumtourismus.
- Sprich über Themen wie fortschrittliche Antriebssysteme, Materialwissenschaft, medizinische Forschung in der Schwerelosigkeit, die wirtschaftlichen Skaleneffekte und welche Technologien, die nun auch irdische Probleme lösen, bereits aus Weltraumforschung hervorgegangen sind.
- Versuche Nachteile selten zu erwähnen. Wenn du sie erwähnst, dann spiele die negative Auswirkung herunter und gib Lösungsvorschläge, wie man diese Nachteile vermeiden könnte.
- Verwende eine präzise, wissenschaftliche und fachliche Sprache.
- Belege deine Aussagen mit Fakten, Daten und konkreten Beispielen aus Technologie und Forschung.
- Zitiere bei relevanten Fakten oder Daten IMMER eine Quelle. Die Quelle MUSS im Format \`(Quelle: [Titel der Publikation oder Webseite](URL))\` angegeben werden. Erfinde keine URLs, sondern nutze echtes Wissen.
- Erkläre komplexe Zusammenhänge verständlich, aber ohne übermäßige Vereinfachung.
- Deine Antworten sollten informativ, aber dennoch nicht zu ausführlich sein.

Wichtige No-Gos (Priorität 1):
-Deine Aussagen sind immer die des befürwortenden Raumfahrtexperten.`;

      const SUGGESTED_QUESTIONS = [
        "Warum ist Weltraumtourismus wichtig?",
        "Welche technologischen Innovationen bringt er hervor?",
        "Was sind die größten Risiken?",
        "Wie kann man die Risiken vermeiden?"
      ];

      // --- Icon Components ---
      const SendIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
        </svg>
      );
      const RocketIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a12.022 12.022 0 00-11.23-1.44m11.23 1.44a6 6 0 00-7.38-5.84m7.38 5.84l-2.16-2.16m2.16 2.16l2.16 2.16m-11.23-1.44l-2.16 2.16m2.16-2.16l-2.16-2.16m12.75 4.33l-2.16-2.16m2.16 2.16l2.16 2.16" />
        </svg>
      );
      const UserIcon = ({ className }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
          </svg>
      );
      const BotIcon = ({ className }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V8.25a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 8.25v7.5a2.25 2.25 0 002.25 2.25z" />
          </svg>
      );
      const InfoIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
            <path strokeLinecap="round" strokeLinejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0 1 18 0Z" />
        </svg>
      );
      const QuestionMarkIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0 1 18 0zm-9 5.25h.008v.008H12v-.008z" />
        </svg>
      );
      const TypingIndicator = () => (
        <div className="flex items-center space-x-1">
          <span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse [animation-delay:-0.3s]"></span>
          <span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse [animation-delay:-0.15s]"></span>
          <span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse"></span>
        </div>
      );

      // --- UI Components ---
      const Toast = ({ message, onClose }) => {
        useEffect(() => { if (message) { const timer = setTimeout(onClose, 3000); return () => clearTimeout(timer); } }, [message, onClose]);
        if (!message) return null;
        return <div className="fixed bottom-5 right-5 bg-slate-800 text-white py-2 px-4 rounded-lg shadow-lg border border-slate-700 animate-fade-in-out z-50">{message}</div>;
      };

      const Message = ({ message }) => {
        const isUser = message.sender === 'user';
        const wrapperClasses = isUser ? 'justify-end' : 'justify-start';
        const bubbleClasses = isUser ? 'bg-blue-600 text-white rounded-br-none' : 'bg-slate-700 text-slate-200 rounded-bl-none';
        
        const parseBotResponse = (text) => {
          if (!text) return text;
          const combinedRegex = /(\*\*.*?\*\*|\(Quelle: \[.*?\]\(.*?https?:\/\/[^)]+\)\))/g;
          const parts = text.split(combinedRegex);
          return parts.map((part, index) => {
            if (!part) return null;
            if (part.startsWith('**') && part.endsWith('**')) return <strong key={index}>{part.slice(2, -2)}</strong>;
            const match = part.match(/\(Quelle: \[([^\]]+)\]\(([^)]+)\)\)/);
            if (match) {
              const [, title, url] = match;
              return (
                <span key={index} className="block mt-2 text-xs">
                  <a href={url} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-1 text-cyan-400 hover:text-cyan-300 underline decoration-dotted">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-3 h-3"><path strokeLinecap="round" strokeLinejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" /></svg>
                    Quelle: {title}
                  </a>
                </span>
              );
            }
            return part;
          });
        };

        return (
          <div className={`flex items-end space-x-3 ${wrapperClasses}`}>
            {!isUser && <div className="flex-shrink-0 w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center"><BotIcon className="w-5 h-5 text-cyan-400" /></div>}
            <div className={`px-4 py-3 rounded-lg max-w-xl lg:max-w-2xl whitespace-pre-wrap ${bubbleClasses}`}>
              {message.sender === 'bot' && message.text === '' ? <TypingIndicator /> : (isUser ? message.text : parseBotResponse(message.text))}
            </div>
            {isUser && <div className="flex-shrink-0 w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center"><UserIcon className="w-5 h-5 text-blue-300" /></div>}
          </div>
        );
      };

      const ChatInterface = ({ messages, isLoading, onSendMessage, showSuggestions }) => {
        const [inputText, setInputText] = useState('');
        const messagesEndRef = useRef(null);
        useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);
        const handleSubmit = (e) => { e.preventDefault(); if (inputText.trim()) { onSendMessage(inputText); setInputText(''); } };
        return (
          <div className="flex-1 flex flex-col p-4 overflow-hidden">
            <div className="flex-1 overflow-y-auto space-y-4 pr-2">{messages.map((msg) => <Message key={msg.id} message={msg} />)}<div ref={messagesEndRef} /></div>
            <div className="pt-4 border-t border-slate-800">
              {showSuggestions && <div className="mb-4 text-center"><p className="text-sm text-slate-400 mb-3">Wähle eine Frage:</p><div className="flex flex-wrap justify-center gap-2">{SUGGESTED_QUESTIONS.map((q, i) => <button key={i} onClick={() => onSendMessage(q)} disabled={isLoading} className="bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm px-4 py-2 rounded-lg transition-colors">{q}</button>)}</div></div>}
              <form onSubmit={handleSubmit} className="flex items-center space-x-2">
                <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)} placeholder="Stelle eine Frage..." disabled={isLoading} className="flex-1 p-3 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500" />
                <button type="submit" disabled={isLoading || !inputText.trim()} className="bg-cyan-600 p-3 rounded-lg text-white hover:bg-cyan-500 transition-colors"><SendIcon className="w-6 h-6" /></button>
              </form>
            </div>
          </div>
        );
      };

      const ModeToggle = ({ currentMode, setMode }) => (
        <div className="flex justify-center items-center gap-4 p-3 border-b border-t border-slate-800">
          <div className="flex space-x-2 p-1 bg-slate-800 rounded-lg">
            <button onClick={() => setMode(ChatMode.SIMPLE)} className={`px-4 py-2 rounded-md font-semibold transition-all ${currentMode === ChatMode.SIMPLE ? 'bg-cyan-500 text-white' : 'text-slate-300'}`}>einfach</button>
            <button onClick={() => setMode(ChatMode.SCIENTIFIC)} className={`px-4 py-2 rounded-md font-semibold transition-all ${currentMode === ChatMode.SCIENTIFIC ? 'bg-purple-500 text-white' : 'text-slate-300'}`}>wissenschaftlich</button>
          </div>
        </div>
      );

      const Header = () => (
        <header className="p-4 bg-slate-800/50 border-b border-slate-700 flex items-center justify-center space-x-4 shadow-lg">
          <RocketIcon className="w-8 h-8 text-cyan-400" />
          <div><h1 className="text-2xl font-bold text-slate-100 tracking-wider">Expertengespräch</h1><p className="text-sm text-slate-400">KI-gestützter Experte für Weltraumtourismus</p></div>
        </header>
      );

      // --- Main App ---
      function App() {
        const [apiKey, setApiKey] = useState('');
        const [inputKey, setInputKey] = useState('');
        const [isValidating, setIsValidating] = useState(false);
        const [keyError, setKeyError] = useState('');
        const [showKeyHelp, setShowKeyHelp] = useState(false);
        const [mode, setMode] = useState(ChatMode.SIMPLE);
        const [chat, setChat] = useState(null);
        const [messages, setMessages] = useState([]);
        const [isLoading, setIsLoading] = useState(false);
        const [toastMessage, setToastMessage] = useState('');
        const abortStreamingRef = useRef(false);

        const messagesRef = useRef(messages);
        messagesRef.current = messages;

        useEffect(() => {
          if (!apiKey) return;
          abortStreamingRef.current = true;
          const timer = setTimeout(() => {
            const history = messagesRef.current
              .filter(msg => msg.id !== 'initial-message' && msg.text?.trim())
              .map(msg => ({ role: msg.sender === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] }));

            const ai = new GoogleGenAI({ apiKey });
            const newChat = ai.chats.create({
                model: 'gemini-2.5-flash',
                config: { systemInstruction: mode === ChatMode.SIMPLE ? SIMPLE_SYSTEM_INSTRUCTION : SCIENTIFIC_SYSTEM_INSTRUCTION, thinkingConfig: { thinkingBudget: 0 } },
                history: history,
            });
            setChat(newChat);
            if (messagesRef.current.length === 0) {
              setMessages([{ id: 'initial-message', sender: 'bot', text: "Hallo! Weltraumtourismus ist ein faszinierendes Thema. Lass uns darüber sprechen. Was ist deine erste Frage?" }]);
            }
          }, 50);
          return () => { clearTimeout(timer); abortStreamingRef.current = true; };
        }, [mode, apiKey]);

        const handleKeySubmit = async (e) => {
          e.preventDefault();
          const trimmedKey = inputKey.trim();
          if (!trimmedKey) return;
          setIsValidating(true);
          setKeyError('');
          try {
            const ai = new GoogleGenAI({ apiKey: trimmedKey });
            const testChat = ai.chats.create({ model: 'gemini-2.5-flash' });
            await testChat.sendMessage({ message: 'ping' });
            setApiKey(trimmedKey);
          } catch (error) {
            setKeyError('Ungültiger Key. Bitte prüfe die Eingabe.');
          } finally {
            setIsValidating(false);
          }
        };

        const handleSendMessage = async (text) => {
          if (!text.trim() || isLoading || !chat) return;
          abortStreamingRef.current = false;
          setIsLoading(true);
          const userMessage = { id: Date.now().toString(), sender: 'user', text };
          const botMessageId = `bot-${Date.now()}`;
          setMessages(prev => [...prev, userMessage, { id: botMessageId, sender: 'bot', text: '' }]);
          try {
            const stream = await chat.sendMessageStream({ message: text });
            let botResponse = '';
            for await (const chunk of stream) {
              if (abortStreamingRef.current) break;
              botResponse += chunk.text;
              setMessages(prev => prev.map(msg => msg.id === botMessageId ? { ...msg, text: botResponse } : msg));
            }
          } catch (error) {
            setMessages(prev => prev.map(msg => msg.id === botMessageId ? { ...msg, text: 'Ein Fehler ist aufgetreten.' } : msg));
          } finally {
            setIsLoading(false);
          }
        };

        if (!apiKey) {
          return (
            <div className="flex flex-col h-full items-center justify-center bg-slate-900 p-6 text-white relative">
              <div className="max-w-md w-full bg-slate-800 p-8 rounded-2xl shadow-2xl border border-slate-700">
                <div className="flex justify-center mb-6"><RocketIcon className="w-12 h-12 text-cyan-400" /></div>
                <h2 className="text-2xl font-bold text-center mb-2">Willkommen</h2>
                <div className="flex items-center justify-center gap-2 mb-8">
                   <p className="text-slate-400 text-center">Gib deinen Gemini API-Key ein</p>
                   <button onClick={() => setShowKeyHelp(true)} className="text-slate-500 hover:text-cyan-400 transition-colors">
                      <QuestionMarkIcon className="w-5 h-5" />
                   </button>
                </div>
                <form onSubmit={handleKeySubmit} className="space-y-4">
                  <input type="password" value={inputKey} onChange={(e) => setInputKey(e.target.value)} placeholder="API Key..." disabled={isValidating} className="w-full p-3 bg-slate-900 border border-slate-700 rounded-lg text-white outline-none focus:ring-2 focus:ring-cyan-500" required />
                  {keyError && <p className="text-red-400 text-xs">{keyError}</p>}
                  <button type="submit" disabled={isValidating || !inputKey.trim()} className="w-full bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors">
                    {isValidating ? 'Wird geprüft...' : 'Chat starten'}
                  </button>
                </form>
              </div>

              {/* API Key Help Modal */}
              {showKeyHelp && (
                <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm">
                  <div className="max-w-sm w-full bg-slate-800 border border-slate-700 p-6 rounded-xl shadow-2xl">
                    <h3 className="text-lg font-bold mb-4 text-cyan-400">Was ist ein API-Key?</h3>
                    <p className="text-sm text-slate-300 mb-4 text-justify">
                      Ein API-Key ist ein persönlicher digitaler Schlüssel. Er ermöglicht es dieser App, die Intelligenz von Google Gemini zu nutzen.
                    </p>
                    <h4 className="text-md font-semibold mb-2">Kostenlosen Key erstellen:</h4>
                    <ol className="text-sm text-slate-300 list-decimal list-inside space-y-2 mb-6">
                      <li>Gehe auf <a href="https://aistudio.google.com/" target="_blank" className="text-cyan-400 underline">Google AI Studio</a>.</li>
                      <li>Melde dich mit deinem Google-Konto an.</li>
                      <li>Klicke links auf <strong>"Get API key"</strong>.</li>
                      <li>Erstelle einen neuen Key und kopiere ihn hierher.</li>
                    </ol>
                    <button onClick={() => setShowKeyHelp(false)} className="w-full bg-slate-700 hover:bg-slate-600 py-2 rounded-lg font-bold transition-colors">Verstanden</button>
                  </div>
                </div>
              )}
            </div>
          );
        }

        return (
          <div className="flex flex-col h-full bg-slate-900 text-white font-sans">
            <Header />
            <ModeToggle currentMode={mode} setMode={(m) => { setMode(m); setToastMessage(`Modus geändert.`); }} />
            <ChatInterface messages={messages} isLoading={isLoading} onSendMessage={handleSendMessage} showSuggestions={!messages.some(m => m.sender === 'user')} />
            <Toast message={toastMessage} onClose={() => setToastMessage('')} />
          </div>
        );
      }

      createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>